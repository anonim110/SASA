<!doctype html>
if (e.key==='s') input.down=false;
if (e.key==='a') input.left=false;
if (e.key==='d') input.right=false;
});


canvas.addEventListener('mousemove', e => {
input.aimX = e.clientX;
input.aimY = e.clientY;
});


canvas.addEventListener('mousedown', e => {
input.shoot = true;
setTimeout(()=> input.shoot=false, 80);
});


// сглаживаем движения
function smoothStep(target, current, speed = 0.2) {
return current + (target - current) * speed;
}


setInterval(()=>{
if (!myId) return;


// плавный переход между 0 и 1
smoothInput.up = smoothStep(input.up ? 1 : 0, smoothInput.up);
smoothInput.down = smoothStep(input.down ? 1 : 0, smoothInput.down);
smoothInput.left = smoothStep(input.left ? 1 : 0, smoothInput.left);
smoothInput.right = smoothStep(input.right ? 1 : 0, smoothInput.right);


socket.send(JSON.stringify({
type:'input',
id: myId,
input: {
up: smoothInput.up > 0.1,
down: smoothInput.down > 0.1,
left: smoothInput.left > 0.1,
right: smoothInput.right > 0.1,
aimX: input.aimX,
aimY: input.aimY,
shoot: input.shoot
}
}));
}, 50);(()=>{ if (!myId) return; socket.send(JSON.stringify({ type:'input', id: myId, input })); }, 50);


function draw(){
ctx.clearRect(0,0,canvas.width, canvas.height);
// draw players
for (const id in state.players) {
const p = state.players[id];
ctx.save();
ctx.translate(p.x, p.y);
ctx.rotate(p.angle||0);
// tank body
ctx.fillStyle = (parseInt(id)===myId)?'#6cf':'#fc6';
ctx.fillRect(-16,-12,32,24);
// turret
ctx.fillStyle = '#222';
ctx.fillRect(0,-5,20,10);
ctx.restore();
// hp
ctx.fillStyle = 'white';
ctx.fillText('HP:'+Math.round(p.hp||0), p.x-20, p.y-18);
}
// bullets
for (const b of state.bullets) {
ctx.beginPath(); ctx.arc(b.x, b.y, 4,0,Math.PI*2); ctx.fill();
}


requestAnimationFrame(draw);
}
requestAnimationFrame(draw);
</script>
</body>
</html>
